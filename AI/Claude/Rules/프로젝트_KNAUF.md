# 📌 프로젝트별 지침 (현재 프로젝트 전용)

🎯 프로젝트 특성

도메인: 웹 기반 업무 관리 시스템 (주문/거래처/메일 알림)

기술 스택: 
- Backend: Spring Boot, MyBatis, MSSQL
- Frontend: JQGrid, jQuery, JSP
- 빌드: Maven
- WAS: Tomcat 9

---

🔧 개발 표준


🎯 실행 규칙

📐 10가지 핵심 공식(변수만 해당)

| # | 공식 | 주요 변수 |
| -- | | |
| 1 | 천재적 통찰력 | GI = (관찰 × 연결 × 패턴 × 통합) / (가정 + 편견) |
| 2 | 다차원 | 5가지 차원: 시간-공간-추상화-인과관계-위계 |
| 3 | 창의적 연결 | 직접 - 간접 - 역설 - 은유 - 시스템 연결 |
| 4 | 문제 재정의 | 180° 뒤집기 - 스케일 이동 - 개념 이동 - 도메인 이동
| 5 | 혁신 솔루션 | 결합-차용-제약→우위-역발상-시스템 재설계
| 6 | 통찰력 증폭 | 5가지 이유 - 만약에 - 어떻게 할 수 있을까?
| 7 <사고의 진화> 학습-경험-성찰-교환-실패 학습
| 8 | 복잡성 해결 | 분해 → 관계 매핑 → 레버리지 포인트 |
| 9 | 직관적 도약 | (침묵 × 경험 × 신뢰) / (논리 × 합리화) |
| 10 | 통합적 지혜 | (지식 + 이해 + 지혜 + 연민 + 행동) × 겸손 × 윤리 |


1. JQGrid 관련 패턴

상태 관리:
- 원본 데이터는 `originalDataMap`에 키-값 쌍으로 저장
- 수정된 행은 `modifiedRowsSet` (Set)으로 추적
- 배경색 변경으로 수정 상태 시각적 표시 (`#ffebcd`)

이벤트 처리:
- `afterSaveCell`: 셀 편집 완료 후 변경감지
- `loadComplete`: 초기 원본 데이터 저장 시점
- `onSelectRow`: multiselect와 편집모드 분리 처리
- 체크박스 클릭: `event.stopPropagation()` + `return false`로 이벤트 격리

데이터 동기화:
- 편집모드 확인: `.hasClass('jqgrow-edit')`
- HTML에서 실제 값 추출: jQuery DOM 파싱 활용
- 정규화 함수 필수: `normalizeValue()`로 타입/공백 통일

저장 프로세스:
1. 모든 편집 중인 행 `saveRow()` 처리
2. HTML 태그 제거 후 실제 값 수집
3. multiselect 체크된 행만 서버 전송
4. 성공 시 원본 데이터 갱신 + 배경색 초기화

---

2. 외부 API 연동 (다음 우편번호 등)

스크립트 로딩 전략:
- 동적 로딩: `document.createElement('script')` 사용
- Promise 기반 비동기 처리
- 타임아웃 설정 (10초) 필수
- 브라우저별 분기 처리 (특히 Edge)

Edge 브라우저 대응:
- HTTPS 프로토콜 강제
- 객체 준비 상태 polling (100ms 간격, 최대 30회)
- CSP(Content Security Policy) 완화 필요시 사용자 안내

에러 처리:
- 로딩 실패 시 대체 UI 제공 (직접 입력 모드)
- 사용자 친화적 에러 메시지
- 브라우저별 상세 해결 가이드 제공

---

3. 배치/스케줄 작업

DB 테이블 설계 원칙:
- 스케줄 정보 테이블: 실행 시간, 상태, 이력 관리
- 로그 테이블: 배치 ID로 그룹핑, 재시도 카운트, 실패 정보
- 대상 관리 테이블: N:M 관계 분리 (스케줄 ↔ 거래처)

인덱스 전략:
- 시간 기반 조회: `(SCHEDULE_TIME, ACTIVE_YN)`
- 로그 조회: `(BATCH_ID)`, `(SCHEDULE_ID, REG_DATE DESC)`
- 상태별 조회: `(SEND_STATUS, SCHEDULE_ID)`

성능 최적화:
- 배치 크기: 1000건 단위
- 진행률 업데이트: 100건마다
- 임시 테이블 활용: 대용량(13,000건+) 엑셀 처리 시

---

4. 파일 업로드/처리

엑셀 처리 전략:
- 동적 컬럼 구조: 메타 테이블로 런타임 스키마 관리
- 임시 테이블: 전체 데이터 먼저 적재 후 배치 처리
- 진행률 추적: 별도 테이블에 실시간 업데이트
- 실패 로그: 개별 행 단위로 사유 기록

대용량 파일 대응:
- 스트리밍 방식 읽기
- 배치 단위 DB 처리
- 메모리 사용량 모니터링
- 타임아웃 대응 (WebSocket으로 진행률 전송)

---

⚠️ 주의사항

1. 데이터 타입 처리

문자열 비교 시 필수:

function normalizeValue(value) {
    if (value === null || value === undefined) return '';
    return String(value).trim();
}


특수문자 처리:
- XML/MyBatis: `&lt;`, `&gt;`, `&amp;` 또는 `<![CDATA[...]]>`
- JavaScript: StringEscapeUtils 활용
- 이메일 검증: RFC 5322 표준 정규식

---

2. 브라우저 호환성

Edge 브라우저 특이사항:
- 추적 방지 "엄격" 모드: 외부 스크립트 차단
- SmartScreen 필터: CDN 스크립트 검증
- localStorage/sessionStorage: Claude.ai artifacts에서 사용 불가

크로스 브라우저 테스트:
- Chrome, Edge, Firefox 각각 검증
- 콘솔 오류 로그 필수 확인
- 폴백 UI 항상 준비

---

3. Git/배포 프로세스

브랜치 전략 (Git Flow 변형):

main (운영)
├── release (운영 대기)
├── develop (테스트 서버)
├── feature/기능명-개발자명
└── hotfix/긴급수정명


운영 배포 시 주의:
- develop에서 필요한 feature만 선별적으로 release 병합
- war 파일 수동 빌드 + VDI 원격 업로드
- 자동화 불가 환경: 변경 사항 체크리스트 필수
- 롤백 대비: 이전 war 파일 백업 보관

---

📚 문서화 규칙

JavaDoc 표준

클래스 레벨:

/
 * 사용자 관리 비즈니스 로직 처리
 * 
 * @author 개발자명
 * @since 1.0
 */
@Service


메서드 레벨:

/
 * 사용자 등록 처리
 * 
 * @param userDto 등록할 사용자 정보
 * @return 등록된 사용자 ID
 * @throws DuplicateEmailException 이메일 중복 시
 */
public Long registerUser(UserDto userDto) { }


주석 작성 원칙

섹션 구분:

// ==================================================================================
// 전역 변수 선언
// ==================================================================================


함수 설명:

/
 * 이메일 형식 유효성 검사
 * @param {string} email - 검사할 이메일
 * @returns {boolean} 유효 여부
 */


---

🔍 디버깅 가이드

1. JQGrid 문제 발생 시

콘솔 확인 사항:

// 현재 상태 확인
debugCurrentState();

// 원본 vs 현재 데이터 비교
console.log('Original:', originalDataMap);
console.log('Modified:', modifiedRowsSet);


체크리스트:
- [ ] `loadComplete`에서 원본 데이터 저장 확인
- [ ] `afterSaveCell` 이벤트 정상 발생 확인
- [ ] HTML 태그가 데이터로 저장되지 않았는지 확인
- [ ] 데이터 타입 일치 여부 확인 (String vs Number)

---

2. 외부 API 로딩 실패 시

단계별 확인:
1. 네트워크 탭에서 스크립트 로딩 상태 확인
2. 콘솔 에러 메시지 확인
3. 브라우저 보안 설정 확인 (Edge 추적 방지 등)
4. CDN 서버 응답 상태 확인

Edge 특화 대응:

// Edge 감지
var isEdge = /Edg/.test(navigator.userAgent);
if (isEdge) {
    // HTTPS 강제 + 객체 준비 대기 로직
}


---

🎨 UI/UX 가이드

사용자 피드백

필수 사항:
- 저장 중: 로딩 인디케이터 표시
- 성공: 토스트 메시지 + 데이터 갱신
- 실패: 구체적인 에러 메시지 + 재시도 옵션
- 진행률: 대용량 처리 시 실시간 퍼센트 표시

배경색 규칙:
- 수정됨: `#ffebcd` (light orange)
- 오류: `#ffcccc` (light red)
- 성공: `#ccffcc` (light green) - 일시적 표시 후 제거

---

🧪 테스트 전략

단위 테스트 우선순위

1. 데이터 정규화 함수: null/undefined/공백 처리
2. 이메일 검증: 다양한 형식 테스트
3. 체크박스 상태 동기화: Y/N ↔ true/false 변환
4. 배치 처리: 경계값 테스트 (0건, 1건, 1000건, 13000건+)

통합 테스트 시나리오

1. 연속 편집 테스트: 빠른 클릭 시 상태 동기화
2. 브라우저별 테스트: Chrome, Edge, Firefox
3. 대용량 데이터: 엑셀 13,000건 업로드
4. 동시 접속: 여러 사용자 동시 편집

---

🚨 운영 이슈 대응

긴급 상황 체크리스트

서비스 오작동 시:
1. 로그 파일 확인 (Tomcat logs)
2. DB 연결 상태 확인
3. 최근 배포 내역 확인
4. 이전 war 파일로 롤백 준비

데이터 불일치 시:
1. 원본 데이터와 현재 데이터 SQL 비교
2. 트랜잭션 로그 확인
3. 캐시 초기화 (브라우저 + 서버)
4. 필요시 데이터 복구 스크립트 실행

---

# 📝 지침 사용 가이드

범용 지침과의 관계

범용 지침 (Settings > Profile):
- 응답 품질, 언어, 검증 원칙 등 모든 대화에 적용
- 예: 한글 우선, 시각적 표현, 불확실성 명시

프로젝트 지침 (이 문서):
- 현재 프로젝트의 기술 스택, 패턴, 제약사항
- 예: JQGrid 패턴, Edge 대응, Git 브랜치 전략

적용 우선순위

1. 프로젝트 지침 (기술적 세부사항)
2. 범용 지침 (품질 표준)
3. 대화 컨텍스트 (즉시 요청 사항)

---

# 📊 지침 요약 통계

총 섹션: 11개  
기술 패턴: 4개 (JQGrid, API 연동, 배치, 파일 처리)  
주의사항: 3개 (데이터 타입, 브라우저, Git/배포)  
문서화/테스트: 4개 (JavaDoc, 디버깅, UI/UX, 운영 대응)

범용 지침과 중복 제거된 항목:
- 언어 규칙 (범용에서 처리)
- 응답 템플릿 (범용에서 처리)
- 불확실성 표시 (범용에서 처리)

---

✅ 지침 검증

- [x] 범용 지침과 중복 내용 없음
- [x] 프로젝트 특화 기술 스택 반영
- [x] 실제 대화 이력 기반 패턴 추출
- [x] 즉시 적용 가능한 구체적 예시 포함
- [x] 구조화된 섹션 분리 (검색 용이)

---

